# 模型评估基准记录

本文档用于记录各个训练阶段的模型评估结果，方便对比后续训练流程的提升效果。

## 📊 评估任务说明

### 评估数据集
- **ARC-Easy**: AI2 Reasoning Challenge (Easy) - 科学推理
- **ARC-Challenge**: AI2 Reasoning Challenge (Challenge) - 更难的推理任务
- **MMLU**: Massive Multitask Language Understanding - 57个学科的多选问答
- **GSM8K**: Grade School Math 8K - 小学数学应用题
- **HumanEval**: Python代码生成任务

### 基线准确率 (Baseline)
- **ARC-Easy**: 25% (多选题4选1的随机基线)
- **ARC-Challenge**: 25% (多选题4选1的随机基线)
- **MMLU**: 25% (多选题4选1的随机基线)
- **GSM8K**: 0% (开放式问题的基线)
- **HumanEval**: 0% (开放式代码生成的基线)

### ChatCORE 指标计算
ChatCORE是相对于基线的归一化准确率：
```
ChatCORE = mean((准确率 - 基线准确率) / (1 - 基线准确率))
```
范围从0（随机基线）到1（完美性能）

---

## 📈 SFT阶段评估结果 (基准)

**评估日期**: 2025-10-29  
**模型来源**: SFT训练  
**模型配置**: d16 (185M参数, 16层)  
**Checkpoint**: step 1952  
**训练阶段**: BASE → MID → SFT

### 评估配置
- **温度 (Temperature)**: 0.0 (确定性生成)
- **最大新Token数**: 512
- **采样数 (num_samples)**: 1
- **Batch Size**: 8
- **GPU数量**: 2 (双卡分布式评估)

### 评估结果

| 任务 | 准确率 | 基线准确率 | 归一化准确率 | 提升百分比 | 状态 |
|------|--------|------------|--------------|------------|------|
| ARC-Easy | **27.74%** (659/2376) | 25.0% | 3.65% | **+10.96%** | ✅ 已完成 |
| ARC-Challenge | **25.17%** (295/1172) | 25.0% | 0.23% | **+0.68%** | ✅ 已完成 |
| MMLU | **26.58%** (3733/14042) | 25.0% | 2.11% | **+6.32%** | ✅ 已完成 |
| GSM8K | **2.27%** | 0.0% | 2.27% | **+2.27%** | ✅ 已完成 |
| HumanEval | **3.05%** | 0.0% | 3.05% | **+3.05%** | ✅ 已完成 |

### ChatCORE 指标
- **ChatCORE**: **2.26%** (平均归一化准确率)

### 完整分析
- **ARC-Easy**: 相比随机基线提升 **10.96%**，表现最好
- **ARC-Challenge**: 接近基线，提升 **0.68%**，仍有改进空间
- **MMLU**: 相比随机基线提升 **6.32%**，表现中等
- **GSM8K**: 数学推理能力有限，准确率 **2.27%**
- **HumanEval**: 代码生成能力有限，准确率 **3.05%**

**归一化准确率计算公式**: `(准确率 - 基线) / (1 - 基线)`
- ARC-Easy: (27.74% - 25%) / (1 - 25%) = 3.65%
- ARC-Challenge: (25.17% - 25%) / (1 - 25%) = 0.23%
- MMLU: (26.58% - 25%) / (1 - 25%) = 2.11%
- GSM8K: (2.27% - 0%) / (1 - 0%) = 2.27%
- HumanEval: (3.05% - 0%) / (1 - 0%) = 3.05%
- **ChatCORE**: (3.65% + 0.23% + 2.11% + 2.27% + 3.05%) / 5 = 2.26%

### 训练损失记录
- **初始验证Loss** (step 0): 1.243950
- **最终训练Loss** (step 1952): 1.263363
- **训练步数**: 1,953步

---

## 📊 后续阶段评估对比

> 后续训练阶段（如RL训练）的评估结果将在此处记录，以便计算提升百分比。

### 提升百分比计算公式
```
提升百分比 = ((新准确率 - 基线准确率) / 基线准确率) × 100%
```

---

## 📝 评估历史

### 2025-10-29 - SFT基线评估
- **开始时间**: 15:59
- **完成时间**: 16:35
- **评估日志**: `logs/sft_baseline_eval_20251029_160727.log`
- **状态**: ✅ 已完成
- **ChatCORE**: 2.26%
- **关键发现**: ARC-Easy表现最佳(+10.96%)，数学和代码生成能力有限

---

## 🔍 评估命令示例

### 运行完整评估
```bash
cd /home/llama/Tools/nanochat
export PYTHONPATH="/home/llama/Tools/nanochat:$PYTHONPATH"
export HF_ENDPOINT="https://hf-mirror.com"
unset ALL_PROXY HTTP_PROXY HTTPS_PROXY http_proxy https_proxy

python scripts/chat_eval.py --nproc 2 -i sft \
  -a "ARC-Easy|ARC-Challenge|MMLU|GSM8K|HumanEval" \
  --model-tag d16 --step 1952 \
  -n 1 -t 0.0 -m 512 -b 8
```

### 运行单个任务评估
```bash
python scripts/chat_eval.py --nproc 2 -i sft \
  -a "ARC-Easy" \
  --model-tag d16 --step 1952 \
  -b 8 --max-problems 100
```

---

*最后更新时间: 2025-10-29 15:59*
